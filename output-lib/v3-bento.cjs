require('./index.css');"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("vue");let $={x:0,y:0},E={x:0,y:0},_=[];function X(a,i,e,t,n,c,l,u){o.watch(u,(h,v)=>{h?(l("dragStart",e.value),document.body.style.cursor="grabbing"):h||(l("dragEnd",i.value),document.body.style.cursor="unset")}),o.watch(()=>c.maximumCells,(h,v)=>{V(i,h)}),o.watch(()=>c.disabled,(h,v)=>{h?s():r()},{immediate:!0}),a.value.addEventListener("pointerdown",h=>{h.preventDefault()},!1);function r(){window.addEventListener("pointerdown",d,!1),window.addEventListener("pointermove",S,!1),window.addEventListener("pointerup",B,!1)}function s(){window.removeEventListener("pointerdown",d,!1),window.removeEventListener("pointermove",S,!1),window.removeEventListener("pointerup",B,!1)}function d(h){$={x:h.clientX,y:h.clientY},e.value=I($),e.value&&(u.value=!0,t.value=Object.assign({},e.value))}function S(h){var L;E={x:h.clientX,y:h.clientY};const v=(E.x-$.x)/n,y=(E.y-$.y)/n;if(!((L=a.value)==null?void 0:L.getBoundingClientRect())||!e.value)return;if(u.value){e.value.x+=v,e.value.y+=y,e.value.x<0&&(e.value.x=0),e.value.x+e.value.width>c.maximumCells&&(e.value.x=c.maximumCells-e.value.width),e.value.y<0&&(e.value.y=0),$={x:h.clientX,y:h.clientY},t.value.x=Math.round(e.value.x),t.value.y=Math.round(e.value.y);const x=[];i.value.forEach(m=>{m.id!==e.value.id&&x.push(m)}),_=A(x);const w=_.length;D(w,x);const p=M(t.value,_);p<t.value.y&&(t.value.y=p);const g=b(_,x);z(t.value,g)}function z(x,w){const p=[];w.forEach((g,m)=>{x.id!==g.id&&N(x,g)&&p.push(g)}),p.forEach(g=>{for(let m=g.y+1;m<=x.y+x.height;m++)g.y=m,z(g,w)})}function b(x,w){const p=[];return Array.from(new Set(x.flat())).forEach(g=>{w.forEach(m=>{m.id===g&&p.findIndex(k=>k.id===m.id)===-1&&p.push(m)})}),p}function D(x,w){for(let p=0;p<x;p++)_[p]&&_[p].length>0&&_[p].forEach(g=>{g&&w.forEach(m=>{if(m.id===g){const k=M(m,_);k<m.y&&(m.y=k)}})}),_=A(w)}}function B(h){e.value&&(e.value.x=t.value.x,e.value.y=t.value.y,e.value=null),$.x=0,$.y=0,C(i),u.value=!1}function I(h){let v=null;const y={x:h.x,y:h.y};let f=document.elementFromPoint(y.x,y.y);for(;f&&!f.classList.contains(c.commonClass);)f=f.parentElement;return f!==null&&f.id&&(v=i.value.filter(z=>z.id===(f==null?void 0:f.id))),v?v[0]:null}}function C(a){const i=a.value.map(t=>t);i.sort((t,n)=>t.y!==n.y?t.y-n.y:t.x-n.x);const e=new Map(i.map((t,n)=>[t.id,n]));a.value.forEach(t=>{const n=e.get(t.id);n!==void 0&&(t.index=n)})}function Y(a,i){const e=F(a.value),t=H(a.value,i.maximumCells);(e||t.length)&&V(a,i.maximumCells)}function V(a,i){const e=a.value.reduce((l,u)=>l+u.y+u.height,0),t=Array.from({length:e}).fill(0).map(()=>Array.from({length:i}).fill(0));C(a);const n=a.value.map(l=>l),c=new Map(n.map((l,u)=>[l.id,u]));n.sort((l,u)=>l.y!==u.y?l.y-u.y:l.x-u.x);for(let l=0;l<n.length;l++){let u=!1;for(let r=0;r<t.length&&!u;r++)for(let s=0;s<t[r].length;s++){if(n[l].width===2&&n[l].height===2&&t[r][s]===0&&t[r][s+1]===0&&t[r+1][s]===0&&t[r+1][s+1]===0){const d=c.get(n[l].id);d&&(a.value[d].x=s,a.value[d].y=r),t[r][s]=1,t[r][s+1]=1,t[r+1][s]=1,t[r+1][s+1]=1,u=!0;break}if(n[l].width===2&&n[l].height===1&&t[r][s]===0&&t[r][s+1]===0){const d=c.get(n[l].id);d&&(a.value[d].x=s,a.value[d].y=r),t[r][s]=1,t[r][s+1]=1,u=!0;break}if(n[l].width===1&&n[l].height===2&&t[r][s]===0&&t[r+1][s]===0){const d=c.get(n[l].id);d&&(a.value[d].x=s,a.value[d].y=r),t[r][s]=1,t[r+1][s]=1,u=!0;break}if(n[l].width===1&&n[l].height===1&&t[r][s]===0){const d=c.get(n[l].id);d&&(a.value[d].x=s,a.value[d].y=r),t[r][s]=1,u=!0;break}}}}function F(a){for(let i=0;i<a.length;i++){const e=a[i];for(let t=i+1;t<a.length;t++){const n=a[t],c=e.x+e.width>n.x&&e.x<n.x+n.width,l=e.y+e.height>n.y&&e.y<n.y+n.height;if(c&&l)return!0}}return!1}function M(a,i){for(let e=a.y-1;e>=0;e--)if(i[e]!==void 0){for(let t=a.x;t<a.x+a.width;t++)if(!(i[e]&&i[e+1]&&i[e][t]!==void 0&&i[e+1][t]!==void 0&&i[e][t]===i[e+1][t])){if(i[e][t]!==void 0)return e+1}}return 0}function A(a){const i=[];return a.forEach(e=>{for(let t=e.y;t<e.y+e.height;t++){i[t]===void 0&&(i[t]=[]);for(let c=e.x;c<e.x+e.width;c++)i[t][c]=e.id}}),i}function N(a,i){return a.x<i.x+i.width&&a.x+a.width>i.x&&a.y<i.y+i.height&&a.y+a.height>i.y}function H(a,i){const e=[];return a.forEach(t=>{const n=t.x+t.width,c=t.x,l=t.y;switch(!0){case n>i:e.push({element:t,type:"maxX"});break;case c<0:e.push({element:t,type:"minX"});break;case l<0:e.push({element:t,type:"minY"});break}}),e}const O={key:0},P={key:1},R={key:1},T=o.defineComponent({__name:"Bento",props:{bentoCells:{},size:{default:100},maximumCells:{default:4},gap:{default:10},disabled:{type:Boolean,default:!1},commonClass:{default:"bento-item"}},emits:["dragStart","dragEnd"],setup(a,{emit:i}){var I;const e=a,t=i,n=o.ref(!1),c=o.computed(()=>`${e.maximumCells*e.size+(e.maximumCells-1)*e.gap}px`),l=o.ref("500px"),u=o.ref(e.bentoCells),r=o.ref(),s=o.ref(),d=o.ref({id:"proxy",index:0,x:0,y:0,width:0,height:0});(I=u.value)!=null&&I.length&&Y(u,e),o.onMounted(()=>{X(r,u,s,d,e.size,e,t,n)}),o.watch(u,h=>{if(h!=null&&h.length){const v=h.reduce((y,f)=>(y==null?void 0:y.y)+(y==null?void 0:y.height)>(f==null?void 0:f.y)+(f==null?void 0:f.height)?y:f);if(!v)return;l.value=`${(v.y+v.height)*e.size+(v.y+v.height-1)*e.gap}px`}},{deep:!0,immediate:!0}),o.provide("size",e.size),o.provide("gap",e.gap),o.provide("commonClass",e.commonClass),o.provide("isDragging",n),o.provide("currentClickedElement",s);const S=!!o.useSlots().default,B=o.computed(()=>u.value.every(v=>v.component)?"data":"slot");return(h,v)=>{var y;return(y=u.value)!=null&&y.length?(o.openBlock(),o.createElementBlock("div",{key:0,ref_key:"bentoContainerRef",ref:r,style:o.normalizeStyle({touchAction:"auto",height:l.value,width:c.value,transition:"all 500ms ease 0s",position:"relative",willChange:"transform",marginLeft:"auto",marginRight:"auto"})},[B.value==="data"?(o.openBlock(),o.createElementBlock("div",O,[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(u.value,(f,z)=>(o.openBlock(),o.createBlock(o.resolveDynamicComponent(f.component),{id:`${f.id}`,key:f.id,modelValue:u.value[z],"onUpdate:modelValue":b=>u.value[z]=b,class:o.normalizeClass(f!==s.value?"bento-item":"z-9"),style:o.normalizeStyle({position:"absolute",transform:`
            translate3d(
              ${f.x*(e.size+e.gap)}px,
              ${f.y*(e.size+e.gap)}px,
            0)`,width:`${f.width===2?f.width*e.size+e.gap:f.width*e.size}px`,height:`${f.height===2?f.height*e.size+e.gap:f.height*e.size}px`})},null,8,["id","modelValue","onUpdate:modelValue","class","style"]))),128))])):o.createCommentVNode("",!0),B.value==="slot"?(o.openBlock(),o.createElementBlock("div",P,[o.renderSlot(h.$slots,"default",{},void 0,!0)])):o.createCommentVNode("",!0),o.withDirectives(o.createElementVNode("div",{class:"bento-item-placeholder",style:o.normalizeStyle({willChange:"transform",position:"absolute",transform:`
          translate3d(
            ${d.value.x*(e.size+e.gap)}px,
            ${d.value.y*(e.size+e.gap)}px,
          0)`,width:`${d.value.width===2?d.value.width*e.size+e.gap:d.value.width*e.size}px`,height:`${d.value.height===2?d.value.height*e.size+e.gap:d.value.height*e.size}px`})},[o.renderSlot(h.$slots,"bento-item-placeholder",{},void 0,!0)],4),[[o.vShow,s.value]])],4)):(o.openBlock(),o.createElementBlock("div",R,[o.renderSlot(h.$slots,"empty",{},void 0,!0)]))}}}),j=(a,i)=>{const e=a.__vccOpts||a;for(const[t,n]of i)e[t]=n;return e},U=j(T,[["__scopeId","data-v-76dc0442"]]),q=["id"],G=o.defineComponent({__name:"BentoItem",props:{id:{},x:{},y:{},width:{default:1},height:{default:1}},setup(a){const i=a,e=o.inject("size"),t=o.inject("gap"),n=o.inject("commonClass"),c=o.inject("currentClickedElement"),l=o.ref("");return o.watch(c,(u,r)=>{var s;i.id===((s=c.value)==null?void 0:s.id)?l.value="z-9":setTimeout(()=>{l.value=""},500)},{deep:!0}),(u,r)=>{var s,d;return o.openBlock(),o.createElementBlock("div",{id:`${i.id}`,class:o.normalizeClass(`${i.id!==((s=o.unref(c))==null?void 0:s.id)?o.unref(n):""} ${l.value}`),style:o.normalizeStyle({willChange:"transform",overflow:"hidden",position:"absolute",transform:i.id===((d=o.unref(c))==null?void 0:d.id)?`translate3d(
            ${o.unref(c).x*(o.unref(e)+o.unref(t))}px,
            ${o.unref(c).y*(o.unref(e)+o.unref(t))}px,
          0)`:`translate3d(
            ${i.x*(o.unref(e)+o.unref(t))}px,
            ${i.y*(o.unref(e)+o.unref(t))}px,
          0)`,width:`${i.width===2?i.width*o.unref(e)+o.unref(t):i.width*o.unref(e)}px`,height:`${i.height===2?i.height*o.unref(e)+o.unref(t):i.height*o.unref(e)}px`,userSelect:"none"})},[o.renderSlot(u.$slots,"default",{},void 0,!0)],14,q)}}}),W=j(G,[["__scopeId","data-v-35bb59f4"]]);exports.Bento=U;exports.BentoItem=W;
